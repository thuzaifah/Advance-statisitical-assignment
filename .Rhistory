getwd()
library(tidyverse)
getwd()
summary(log_hba1c)
knitr::opts_chunk$set(
message   = FALSE,
warning   = FALSE
)
library(here)
library(tidyverse)
library(haven)
library(gtsummary)
library(VGAM)
library(nnet)
library(broom)
library(knitr)
library(kableExtra)
library(tibble)
library(purrr)
library(gt)
library(ggplot2)
library(ggeffects)
library(reshape2)
library(data.table)
library(foreign)
library(gridExtra)
library(grid)
library(viridis)
library(ggpubr)
library(rmarkdown)
library(readxl)
datafbs <- read_csv("datamssm_b.csv")
glimpse(datafbs)
datafbs <- datafbs %>%
mutate(across(where(is.character), as.factor))
glimpse(datafbs)
datafbs <- datafbs %>%
select(fbs, hba1c, ftrigliz, age, waist)
# inspect the selected data
glimpse(datafbs)
datafbs <- datafbs %>%
rename(
fbs_raw = fbs,
hba1c = hba1c,
triglycerides = ftrigliz,
age = age,
waist_circumference = waist
)
datafbs <- datafbs %>%
mutate(
cat_fbs = case_when(
fbs_raw < 5.6 ~ "normal",
fbs_raw >= 5.6 & fbs_raw < 7.0 ~ "prediabetes",
fbs_raw >= 7.0 ~ "diabetes"
),
cat_fbs = factor(cat_fbs, levels = c("diabetes", "prediabetes", "normal"))
)
summary(datafbs)
datafbs %>%
count(cat_fbs)
# select predictors and outcome
datafbs <- datafbs %>%
select(cat_fbs, hba1c, triglycerides, age, waist_circumference)
# relevel cat_fbs into desired order
datafbs <- datafbs %>%
mutate(cat_fbs = factor(cat_fbs, levels = c("normal", "prediabetes", "diabetes")))
# create table summary
datafbs %>%
tbl_summary(
by = cat_fbs,
statistic = list(all_continuous() ~ "{mean} ({sd})"),
digits = all_continuous() ~ 2
) %>%
add_overall() %>%
bold_labels()
# Count cat_fbs categories and calculate percentages
fbs_counts <- datafbs %>% count(cat_fbs)
fbs_counts$percent <- round(fbs_counts$n / sum(fbs_counts$n) * 100, 2)
# Define custom colors for the categories
custom_colors <- c('#A6CEE3', '#FDBF6F', '#B2DF8A')  # Light blue, orange, green
# Pie chart for cat_fbs
p1 <- ggplot(fbs_counts, aes(x = "", y = n, fill = cat_fbs)) +
geom_bar(width = 1, stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(percent, "%")), position = position_stack(vjust = 0.5)) +
labs(title = "FBS Category Distribution", fill = "FBS Category") +
scale_fill_manual(values = custom_colors) +
theme_void()
# Bar chart for cat_fbs
p2 <- ggplot(fbs_counts, aes(x = cat_fbs, y = n, fill = cat_fbs)) +
geom_bar(stat = "identity") +
geom_text(aes(label = n), vjust = -0.5) +
labs(title = "FBS Category Count", x = "FBS Category", y = "Count") +
scale_fill_manual(values = custom_colors) +
theme_minimal()
# Combine both plots into one row
gridExtra::grid.arrange(p1, p2, ncol = 2, top = grid::textGrob(
"Distribution of FBS Categories",
gp = grid::gpar(fontsize = 20, fontface = "bold")
))
datafbs |>
ggplot(aes(hba1c)) +
geom_histogram() +
facet_grid(. ~ cat_fbs)
datafbs |>
ggplot(aes(age)) +
geom_histogram() +
facet_grid(. ~ cat_fbs)
datafbs |>
ggplot(aes(triglycerides)) +
geom_histogram() +
facet_grid(. ~ cat_fbs)
datafbs |>
ggplot(aes(waist_circumference)) +
geom_histogram() +
facet_grid(. ~ cat_fbs)
levels(datafbs$cat_fbs)
datafbs <- datafbs  %>%
mutate(cat_fbs = fct_relevel(cat_fbs,
c("diabetes", 'prediabetes', 'normal')))
levels(datafbs$cat_fbs)
log_hba1c <- vglm(cat_fbs ~ hba1c,
multinomial, data = datafbs)
summary(log_hba1c)
log_triglycerides <- vglm(cat_fbs ~ triglycerides,
multinomial, data = datafbs)
summary(log_triglycerides)
log_age <- vglm(cat_fbs ~ age,
multinomial, data = datafbs)
summary(log_age)
log_waist <- vglm(cat_fbs ~ waist_circumference,
multinomial, data = datafbs)
summary(log_waist)
mlog <- vglm(cat_fbs ~ hba1c + triglycerides + age + waist_circumference,
family = multinomial, data = datafbs)
summary(mlog)
mlog_interaction <- vglm(cat_fbs ~ hba1c + triglycerides + age + waist_circumference +
age*waist_circumference,
family = multinomial,
data = datafbs)
summary(mlog_interaction)
datafbs  <- datafbs  %>%
mutate(cat_fbs_relev = relevel(cat_fbs, ref = "normal"))
levels(datafbs$cat_fbs_relev)
mlog_nnet <- multinom(cat_fbs_relev ~ hba1c + triglycerides + age + waist_circumference, data = datafbs)
summary(mlog_nnet)
summary(mlog)
b_mlog <- coef(mlog)
ci_mlog <- confint(mlog)
b_ci_mlog <- data.frame(b_mlog,ci_mlog) %>%
rename("log odds" = b_mlog, "Lower CI" = X2.5.., "Upper CI" = X97.5..)
b_ci_mlog %>%
kbl(digits = 2, booktabs = T, caption = "Log odds from multinomial logistic regression") %>%
kable_styling(position = "center")
rrr_mlog <- exp(b_ci_mlog)
tab_mlog <- cbind(b_ci_mlog, rrr_mlog)
colnames(tab_mlog) <- c('b', 'lower b', 'upper b',
'RRR', 'lower RRR', 'upper RRR')
tab_mlog %>%
kbl(digits = 2, booktabs = T, caption = "Log odds and RRR from multinomial logistic regression") %>%
kable_styling(position = "center")
# Build final table using provided values
data <- data.frame(
Group = c("Diabetes", "", "", "Prediabetes", "", ""),
Variable = c("Intercept", "hba1c", "triglycerides", "Intercept", "hba1c", "triglycerides"),
B = c(-11.99, 1.24, 0.33, -6.88, 0.48, 0.21),
SE = c(0.55, 0.06, 0.05, 0.39, 0.06, 0.04),
Wald = c(-21.72, 20.72, 6.45, -17.62, 8.33, 5.22),
p = c("<0.001", "<0.001", "<0.001", "<0.001", "<0.001", "<0.001"),
OR = c(0.00, 3.47, 1.39, 0.00, 1.62, 1.24),
`95%CI` = c(
"(0.00, 0.00)", "(3.09, 3.90)", "(1.25, 1.53)",
"(0.00, 0.00)", "(1.45, 1.81)", "(1.14, 1.34)"
)
)
# Create styled table
kbl(data, booktabs = TRUE,
col.names = c("Group", "Variable", "B", "SE", "Wald", "p", "OR", "95% CI"),
caption = "Table 2: Log odds and RRR from multinomial logistic regression") %>%
kable_styling(full_width = FALSE, position = "center") %>%
column_spec(1, bold = TRUE, border_right = TRUE) %>%
row_spec(0, bold = TRUE, color = "white", background = "#D7261E") %>%
footnote(general = "a The reference group is normal")
z.test <- summary(mlog_nnet)$coefficients/summary(mlog_nnet)$standard.errors
# 2-tailed
p.val <- (1 - pnorm(abs(z.test), 0, 1)) * 2
colnames(p.val) <- c('p-val intercept', 'p-val hba1c', 'p-val triglycerides', 'p-val age', 'p-val waist_circumference')
p.val
confint(mlog_nnet, level=0.95)
summary(log_hba1c)
head(predict.vgam(log_hba1c, type = 'link'))
head(datafbs)[1:3,]
# ptn 1: hba1c = 4.2
# logit cat_fbs=diabetes = [1]  vs cat_fbs=normal =[3]
#-10.42508  +  1.47018 *4.2
-10.42508   +  1.47018 *4.2
# logit cat_fbs=prediabetes = [2]  vs cat_fbs=normal =[3]
#-5.16554  +  0.73734*4.2
-5.16554   +  0.73734*4.2
# ptn 3: hba1c = 5.0
# logit cat_fbs=diabetes = [1]  vs cat_fbs=normal =[3]
#-10.42508  +  1.47018 *5.0
-10.42508   +  1.47018 *5.0
# logit cat_fbs=prediabetes = [2]  vs cat_fbs=normal =[3]
#-5.16554  +  0.73734*5.0
-5.16554   +  0.73734*5.0
head(predict.vgam(log_hba1c, type = 'response'))
# probability being in the reference group (cat_fbs == normal = [3])
# 1/(1 + exp(-4.250306) + exp(-2.0687082)
1/(1 + exp( -4.250306  ) + exp(-2.0687082))
# probability being in the prediabetes group (cat_fbs == prediabetes = [2])
# exp(-2.0687082)/(1 + exp(-4.250306) + exp(-2.0687082)
exp(-2.0687082)/(1 + exp( -4.250306  ) + exp(-2.0687082))
# probability being in the diabetes group (cat_fbs == diabetes = [1])
# exp(-4.250306)/(1 + exp(-4.250306) + exp(-2.0687082)
exp(-4.250306)/(1 + exp( -4.250306  ) + exp(-2.0687082))
# Assuming datafbs is your data frame
# Creating the summary table with the caption
datafbs %>%
select(-cat_fbs,-hba1c,-triglycerides,-age,-waist_circumference) %>%
tbl_summary(
by = cat_fbs,
statistic = list(all_continuous() ~ "{mean} ({sd})")
) %>%
modify_caption("**Table 1: Characteristics of cat_fbs**")
# Assuming datafbs is your data frame
# Creating the summary table with the caption
datafbs %>%
select(-cat_fbs,-hba1c,-triglycerides,-age,-waist_circumference) %>%
tbl_summary(
by = cat_fbs,
statistic = list(all_continuous() ~ "{mean} ({sd})")
) %>%
modify_caption("**Table 1: Characteristics of cat_fbs**")
# Assuming datafbs is your data frame
# Creating the summary table with the caption
datafbs %>%
select(-cat_fbs,-hba1c,-triglycerides,-age,-waist_circumference,-cat_fbs_relev) %>%
tbl_summary(
by = cat_fbs,
statistic = list(all_continuous() ~ "{mean} ({sd})")
) %>%
modify_caption("**Table 1: Characteristics of cat_fbs**")
# Assuming datafbs is your data frame
# Creating the summary table with the caption
datafbs %>%
select(-cat_fbs,-hba1c,-triglycerides,-age,-waist_circumference,-cat_fbs_relev) %>%
tbl_summary(
by = cat_fbs_relev,
statistic = list(all_continuous() ~ "{mean} ({sd})")
) %>%
modify_caption("**Table 1: Characteristics of cat_fbs**")
# Assuming datafbs is your data frame
# Creating the summary table with the caption
datafbs %>%
select(-cat_fbs,-hba1c,-triglycerides,-age,-waist_circumference) %>%
tbl_summary(
by = cat_fbs,
statistic = list(all_continuous() ~ "{mean} ({sd})")
) %>%
modify_caption("**Table 1: Characteristics of cat_fbs**")
# Assuming datafbs is your data frame
# Creating the summary table with the caption
datafbs %>%
select(cat_fbs, everything(), -hba1c, -triglycerides, -age, -waist_circumference) %>%
tbl_summary(
by = cat_fbs,
statistic = list(all_continuous() ~ "{mean} ({sd})")
) %>%
modify_caption("**Table 1: Characteristics of cat_fbs**")
# Assuming datafbs is your data frame
# Creating the summary table with the caption
# Table 1: Descriptive statistics by FBS category
datafbs %>%
select(cat_fbs, hba1c, triglycerides, age, waist_circumference) %>%
tbl_summary(
by = cat_fbs,
statistic = all_continuous() ~ "{mean} ({sd})",
digits = all_continuous() ~ 2,
label = list(
hba1c ~ "HbA1c",
triglycerides ~ "Triglycerides",
age ~ "Age",
waist_circumference ~ "Waist Circumference"
)
) %>%
add_overall() %>%
modify_caption("**Table 1: Characteristics of FBS Categories**") %>%
bold_labels()
# Assuming datafbs is your data frame
# Creating the summary table with the caption
datafbs %>%
select(cat_fbs, hba1c, triglycerides, age, waist_circumference) %>%
tbl_summary(
by = cat_fbs,
statistic = all_continuous() ~ "{mean} ({sd})",
digits = all_continuous() ~ 2,
missing = "no",
label = list(
hba1c ~ "HbA1c",
triglycerides ~ "Triglycerides",
age ~ "Age",
waist_circumference ~ "Waist Circumference"
)
) %>%
add_overall() %>%
modify_caption("**Table 1: Characteristics of FBS Categories**") %>%
bold_labels()
# relevel cat_fbs into desired order
datafbs <- datafbs %>%
mutate(cat_fbs = factor(cat_fbs, levels = c("normal", "prediabetes", "diabetes")))
# create table summary
datafbs %>%
tbl_summary(
by = cat_fbs,
statistic = list(all_continuous() ~ "{mean} ({sd})"),
digits = all_continuous() ~ 2,
missing = "no"
) %>%
add_overall() %>%
bold_labels()
data <- data.frame(
Group = c("Diabetes", "", "", "Prediabetes", "", ""),
Variable = c("Intercept", "hba1c", "triglycerides", "Intercept", "hba1c", "triglycerides"),
B = c(-11.99, 1.24, 0.33, -6.88, 0.48, 0.21),
SE = c(0.55, 0.06, 0.05, 0.39, 0.06, 0.04),
Wald = c(-21.72, 20.72, 6.45, -17.62, 8.33, 5.22),
p = c("<0.001", "<0.001", "<0.001", "<0.001", "<0.001", "<0.001"),
OR = c(0.00, 3.47, 1.39, 0.00, 1.62, 1.24),
`95%CI` = c(
"(0.00, 0.00)", "(3.09, 3.90)", "(1.25, 1.53)",
"(0.00, 0.00)", "(1.45, 1.81)", "(1.14, 1.34)"
)
)
# Create styled table
kbl(data, booktabs = TRUE,
col.names = c("Group", "Variable", "B", "SE", "Wald", "p", "OR", "95% CI"),
caption = "Table 2: Log odds and RRR from multinomial logistic regression") %>%
kable_styling(full_width = FALSE, position = "center") %>%
column_spec(1, bold = TRUE, border_right = TRUE) %>%
row_spec(0, bold = TRUE, color = "white", background = "#D7261E") %>%
footnote(general = "a The reference group is normal")
library(kableExtra)
# Updated data with 4 predictors
data <- data.frame(
Group = c("Diabetes", "", "", "", "",
"Prediabetes", "", "", "", ""),
Variable = c("Intercept", "hba1c", "triglycerides", "age", "waist_circumference",
"Intercept", "hba1c", "triglycerides", "age", "waist_circumference"),
B = c(-11.99, 1.24, 0.33, 0.02, 0.01,
-6.88, 0.48, 0.21, 0.03, 0.02),
SE = c(0.55, 0.06, 0.05, 0.005, 0.005,
0.39, 0.06, 0.04, 0.003, 0.003),
Wald = c(-21.72, 20.72, 6.45, 4.96, 2.76,
-17.62, 8.33, 5.22, 8.87, 5.24),
p = c("<0.001", "<0.001", "<0.001", "<0.001", "0.006",
"<0.001", "<0.001", "<0.001", "<0.001", "<0.001"),
OR = c(0.00, 3.47, 1.39, 1.02, 1.01,
0.00, 1.62, 1.24, 1.03, 1.02),
`95%CI` = c(
"(0.00, 0.00)", "(3.09, 3.90)", "(1.25, 1.53)", "(1.01, 1.03)", "(1.00, 1.02)",
"(0.00, 0.00)", "(1.45, 1.81)", "(1.14, 1.34)", "(1.02, 1.03)", "(1.01, 1.02)"
)
)
# Create styled table
kbl(data, booktabs = TRUE,
col.names = c("Group", "Variable", "B", "SE", "Wald", "p", "OR", "95% CI"),
caption = "Table 2: Log odds and RRR from multinomial logistic regression") %>%
kable_styling(full_width = FALSE, position = "center") %>%
column_spec(1, bold = TRUE, border_right = TRUE) %>%
row_spec(0, bold = TRUE, color = "white", background = "#D7261E") %>%
footnote(general = "a The reference group is normal")
